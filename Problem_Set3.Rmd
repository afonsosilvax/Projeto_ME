---
title: "Problem_Set3"
author: "Afonso Silva, Tomás Ribeiro, Rui Chaves e Leonor Pereira"
date: "2023-10-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#importações

#install.packages("simmer.plot")
#install.packages("simmer")
library(simmer)
library(magrittr)
library(simmer.plot)
```

```{r}
consulta <- function() {as.numeric(sample(0:2, 1, replace = T, prob = c(0.30, 0.60, 0.10)))}
# 0-sem consulta, 1-consulta telefónica, 2-consulta presencial
```

```{r}
# Funções
chegada_contactos <- function() as.numeric(rexp(1, 2/3))

telefonemas <- function() as.numeric(rexp(1, 1.7/3))
mensagens <- function() as.numeric(rexp(1, 0.3/3))
  
triagem <- function() as.numeric(rnorm(1, 4, 1))
tomada_decisao <- function() as.numeric(rnorm(1, 1, 0.25))
marcacao_consulta <- function() as.numeric(rnorm(1, 1, 0.25))

tempo <- function() ifelse(consulta() == 0, triagem() + tomada_decisao(), triagem() + tomada_decisao() + marcacao_consulta())
```

```{r}
set.seed(2023)


contactos <- trajectory("Gestao_contactos") %>%
  log_("Cheguei") %>%
  
  renege_in(5, out = trajectory("Rejeita chamada") %>% log_("Desliguei a chamada")) %>%
  
  seize("administrativo") %>%
  renege_abort() %>%
  log_("Vou agora ser atendido") %>%
  
  set_attribute("tipo_consulta", tempo) %>%
  
  timeout_from_attribute("tipo_consulta") %>%
  
  release("administrativo") %>%
  log_("Já fui atendido")

env <- simmer("servico") %>%
  add_resource("administrativo", 2) %>%
  add_generator("Telefonema", contactos, telefonemas) %>%
  add_generator("Mensagem", contactos, mensagens) %>%
  run(600)

```

```{r}
# distinção telefone mensagem
set_attribute("tipo_contato", function() ifelse(runif(1) < 0.85, "telefone", "mensagem"))
```

